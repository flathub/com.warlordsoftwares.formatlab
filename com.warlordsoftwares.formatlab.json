{
  "app-id": "com.warlordsoftwares.formatlab",
  "default-branch": "stable",
  "runtime": "org.kde.Platform",
  "runtime-version": "5.15-23.08",
  "sdk": "org.kde.Sdk",
  "add-extensions": {
    "org.freedesktop.Platform.ffmpeg-full": {
      "directory": "lib/ffmpeg",
      "version": "24.08",
      "add-ld-path": "."
    }
  },
  "base": "com.riverbankcomputing.PyQt.BaseApp",
  "base-version": "5.15-23.08",
  "command": "formatlab.sh",
  "build-options": {
    "env": [
      "BASEAPP_REMOVE_WEBENGINE=1"
    ]
  },
  "tags": [
    "proprietary"
  ],
  "finish-args": [
    "--share=network",
    "--share=ipc",
    "--socket=fallback-x11",
    "--socket=wayland",
    "--socket=pulseaudio",
    "--device=all",
    "--filesystem=xdg-download",
    "--filesystem=xdg-documents",
    "--filesystem=xdg-music",
    "--filesystem=xdg-videos",
    "--filesystem=/media",
    "--filesystem=/run/media",
    "--filesystem=xdg-run/gvfs",
    "--filesystem=xdg-run/gvfsd",
    "--talk-name=org.gtk.vfs.*",
    "--env=QT_ENABLE_HIGHDPI_SCALING=1",
    "--env=PACKAGE_TYPE=flatpak"
  ],
  "cleanup-commands": [
    "/app/cleanup-BaseApp.sh",
    "mkdir -p /app/lib/ffmpeg"
  ],
  "cleanup": [
    "/include",
    "/lib/pkgconfig",
    "/lib/cmake",
    "*.a",
    "*.la"
  ],
  "modules": [
    {
      "name": "libass",
      "sources": [
        {
          "type": "archive",
          "url": "https://github.com/libass/libass/releases/download/0.17.1/libass-0.17.1.tar.xz",
          "sha256": "f0da0bbfba476c16ae3e1cfd862256d30915911f7abaa1b16ce62ee653192784"
        },
        {
          "type": "script",
          "commands": [
            "autoreconf -fiv"
          ],
          "dest-filename": "autogen.sh"
        }
      ],
      "cleanup": [
        "/include",
        "/lib/pkgconfig",
        "/share",
        "*.a",
        "*.la"
      ]
    },
    {
      "name": "luajit",
      "no-autogen": true,
      "make-install-args": [
        "PREFIX=${FLATPAK_DEST}"
      ],
      "cleanup": [
        "/bin",
        "/include",
        "/lib/pkgconfig",
        "/share/man"
      ],
      "sources": [
        {
          "type": "git",
          "url": "https://github.com/LuaJIT/LuaJIT.git",
          "commit": "4c2441c16ce3c4e312aaefecc6d40c4fe21de97c"
        }
      ]
    },
    {
      "name": "opencl-headers",
      "buildsystem": "simple",
      "build-commands": [
        "cp -av CL /app/include"
      ],
      "sources": [
        {
          "type": "archive",
          "url": "https://github.com/KhronosGroup/OpenCL-Headers/archive/refs/tags/v2025.07.22.tar.gz",
          "sha256": "98f0a3ea26b4aec051e533cb1750db2998ab8e82eda97269ed6efe66ec94a240"
        }
      ]
    },
    {
      "name": "amf-headers",
      "buildsystem": "simple",
      "build-commands": [
        "cp -av amf/public/include/. /app/include/AMF"
      ],
      "sources": [
        {
          "type": "archive",
          "url": "https://github.com/GPUOpen-LibrariesAndSDKs/AMF/archive/refs/tags/v1.4.36.tar.gz",
          "sha256": "240a42033babc7920e5476506d5ac0c5628f67908833168e746406808d0ef146"
        }
      ]
    },
    {
      "name": "python3-req",
      "buildsystem": "simple",
      "build-commands": [],
      "modules": [
        {
          "name": "python3-requests",
          "buildsystem": "simple",
          "build-commands": [
            "pip3 install --verbose --exists-action=i --no-index --find-links=\"file://${PWD}\" --prefix=${FLATPAK_DEST} \"requests\" --no-build-isolation"
          ],
          "sources": [
            {
              "type": "file",
              "url": "https://files.pythonhosted.org/packages/64/62/428ef076be88fa93716b576e4a01f919d25968913e817077a386fcbe4f42/certifi-2023.11.17-py3-none-any.whl",
              "sha256": "e036ab49d5b79556f99cfc2d9320b34cfbe5be05c5871b51de9329f0603b0474"
            },
            {
              "type": "file",
              "url": "https://files.pythonhosted.org/packages/63/09/c1bc53dab74b1816a00d8d030de5bf98f724c52c1635e07681d312f20be8/charset-normalizer-3.3.2.tar.gz",
              "sha256": "f30c3cb33b24454a82faecaf01b19c18562b1e89558fb6c56de4d9118a032fd5"
            },
            {
              "type": "file",
              "url": "https://files.pythonhosted.org/packages/c2/e7/a82b05cf63a603df6e68d59ae6a68bf5064484a0718ea5033660af4b54a9/idna-3.6-py3-none-any.whl",
              "sha256": "c05567e9c24a6b9faaa835c4821bad0590fbb9d5779e7caa6e1cc4978e7eb24f"
            },
            {
              "type": "file",
              "url": "https://files.pythonhosted.org/packages/70/8e/0e2d847013cb52cd35b38c009bb167a1a26b2ce6cd6965bf26b47bc0bf44/requests-2.31.0-py3-none-any.whl",
              "sha256": "58cd2187c01e70e6e26505bca751777aa9f2ee0b7f4300988b709f44e013003f"
            },
            {
              "type": "file",
              "url": "https://files.pythonhosted.org/packages/96/94/c31f58c7a7f470d5665935262ebd7455c7e4c7782eb525658d3dbf4b9403/urllib3-2.1.0-py3-none-any.whl",
              "sha256": "55901e917a5896a349ff771be919f8bd99aff50b79fe58fec595eb37bbc56bb3"
            }
          ]
        },
        {
          "name": "python3-psutil",
          "buildsystem": "simple",
          "build-commands": [
            "pip3 install --verbose --exists-action=i --no-index --find-links=\"file://${PWD}\" --prefix=${FLATPAK_DEST} \"psutil\" --no-build-isolation"
          ],
          "sources": [
            {
              "type": "file",
              "url": "https://files.pythonhosted.org/packages/90/c7/6dc0a455d111f68ee43f27793971cf03fe29b6ef972042549db29eec39a2/psutil-5.9.8.tar.gz",
              "sha256": "6be126e3225486dff286a8fb9a06246a5253f4c7c53b475ea5f5ac934e64194c"
            }
          ]
        },
        {
          "name": "python3-python-slugify",
          "buildsystem": "simple",
          "build-commands": [
            "pip3 install --verbose --exists-action=i --no-index --find-links=\"file://${PWD}\" --prefix=${FLATPAK_DEST} \"python-slugify\" --no-build-isolation"
          ],
          "sources": [
            {
              "type": "file",
              "url": "https://files.pythonhosted.org/packages/b4/85/6aa722a11307ec572682023b76cad4c52cda708dfc25fcb4b4a6051da7ab/python_slugify-8.0.1-py2.py3-none-any.whl",
              "sha256": "70ca6ea68fe63ecc8fa4fcf00ae651fc8a5d02d93dcd12ae6d4fc7ca46c4d395"
            },
            {
              "type": "file",
              "url": "https://files.pythonhosted.org/packages/a6/a5/c0b6468d3824fe3fde30dbb5e1f687b291608f9473681bbf7dabbf5a87d7/text_unidecode-1.3-py2.py3-none-any.whl",
              "sha256": "1311f10e8b895935241623731c2ba64f4c455287888b18189350b67134a822e8"
            }
          ]
        },
        {
          "name": "python3-ffmpeg-python",
          "buildsystem": "simple",
          "build-commands": [
            "pip3 install --verbose --exists-action=i --no-index --find-links=\"file://${PWD}\" --prefix=${FLATPAK_DEST} \"ffmpeg-python\" --no-build-isolation"
          ],
          "sources": [
            {
              "type": "file",
              "url": "https://files.pythonhosted.org/packages/d7/0c/56be52741f75bad4dc6555991fabd2e07b432d333da82c11ad701123888a/ffmpeg_python-0.2.0-py3-none-any.whl",
              "sha256": "ac441a0404e053f8b6a1113a77c0f452f1cfc62f6344a769475ffdc0f56c23c5"
            },
            {
              "type": "file",
              "url": "https://files.pythonhosted.org/packages/8f/2e/cf6accf7415237d6faeeebdc7832023c90e0282aa16fd3263db0eb4715ec/future-0.18.3.tar.gz",
              "sha256": "34a17436ed1e96697a86f9de3d15a3b0be01d8bc8de9c1dffd59fb8234ed5307"
            }
          ]
        },
        {
          "name": "python3-pycryptodome",
          "buildsystem": "simple",
          "build-commands": [
            "pip3 install --verbose --exists-action=i --no-index --find-links=\"file://${PWD}\" --prefix=${FLATPAK_DEST} \"pycryptodome\" --no-build-isolation"
          ],
          "sources": [
            {
              "type": "file",
              "url": "https://files.pythonhosted.org/packages/b9/ed/19223a0a0186b8a91ebbdd2852865839237a21c74f1fbc4b8d5b62965239/pycryptodome-3.20.0.tar.gz",
              "sha256": "09609209ed7de61c2b560cc5c8c4fbf892f8b15b1faf7e4cbffac97db1fffda7"
            }
          ]
        }
      ]
    },
    {
      "name": "mpv",
      "buildsystem": "simple",
      "build-commands": [
        "python3 waf configure --disable-alsa --disable-build-date --disable-manpage-build --prefix=/app",
        "python3 waf build",
        "python3 waf install"
      ],
      "sources": [
        {
          "type": "archive",
          "url": "https://github.com/mpv-player/mpv/archive/v0.36.0.tar.gz",
          "sha256": "29abc44f8ebee013bb2f9fe14d80b30db19b534c679056e4851ceadf5a5e8bf6"
        },
        {
          "type": "file",
          "url": "https://waf.io/waf-2.0.26",
          "sha256": "dcec3e179f9c33a66544f1b3d7d91f20f6373530510fa6a858cddb6bfdcde14b",
          "dest-filename": "waf"
        }
      ],
      "post-install": [
        "mkdir -p /app/etc/mpv/"
      ],
      "cleanup": [
        "/include",
        "/lib/pkgconfig",
        "/share"
      ]
    },
    {
      "name": "formatlab",
      "buildsystem": "simple",
      "build-commands": [
        "mkdir -p ${FLATPAK_DEST}/formatlab",
        "cp -r * ${FLATPAK_DEST}/formatlab",
        "install -Dm755 ${FLATPAK_DEST}/formatlab/formatlab.sh ${FLATPAK_DEST}/bin/formatlab.sh",
        "install -Dm644 ${FLATPAK_DEST}/formatlab/share/icons/icon.png ${FLATPAK_DEST}/share/icons/hicolor/512x512/apps/com.warlordsoftwares.formatlab.png",
        "install -Dm644 ${FLATPAK_DEST}/formatlab/share/applications/formatlab.desktop ${FLATPAK_DEST}/share/applications/com.warlordsoftwares.formatlab.desktop",
        "desktop-file-edit --set-icon=${FLATPAK_ID} ${FLATPAK_DEST}/share/applications/com.warlordsoftwares.formatlab.desktop",
        "install -Dm644 ${FLATPAK_DEST}/formatlab/share/metainfo/com.warlordsoftwares.formatlab.metainfo.xml ${FLATPAK_DEST}/share/metainfo/com.warlordsoftwares.formatlab.metainfo.xml"
      ],
      "sources": [
        {
          "type": "archive",
          "url": "https://warlordsoftwares.com/static/app_builds/flatpak/FLATPAK_FORMAT_LAB.tar.gz",
          "sha256": "9365c1c734d9f11b2aebe72ff8bbcde740afbf4984d4594ffd30fcedefa91d42"
        }
      ]
    }
  ]
}